# PVS Dashboard – Configuration Overview

This document summarizes all important configuration values (paths, servers, URLs, and scripts) for the **Adient Loznica PVS** solution.

---

## 1. Project Root

- Project folder (code):
  - `G:\Logistics\4_BSA\9_Scripts_Reports\Daily_Production_IT`

- Main components:
  - `pvs_server.py` – Flask backend (when using VM/service)
  - `templates/pvs.html` – Live dashboard (API-driven)
  - `templates/pvs_static.html` – Static snapshot template
  - `scripts/generate_static_pvs.py` – Generates static snapshot HTML
  - `scripts/deploy_to_netlify.ps1` – Deploys static snapshot to Netlify
  - `deploy_now.bat` – One-click Netlify deploy
  - `config/settings.json` – Central configuration
  - `PVS/ProdLine_Project_Map.csv` – Line code → display name

---

## 2. Data Sources

### 2.1 WH Receipt workbook (plan source)

- File: `G:\Logistics\6_Reporting\1_PVS\WH Receipt FY25.xlsx`
- Sheet: `Daily PVS`
- Target label in column 3: `Target (LTP input)`

Used by `load_planned_from_wh_receipt()` inside `pvs_server.py` when
`behavior.useWhReceiptForPlan = true` in `config/settings.json`.

### 2.2 Planned_qtys (legacy/fallback)

- File: `G:\Logistics\4_BSA\9_Scripts_Reports\Daily_Production_IT\PVS\Planned_qtys.xlsx`

Used only if `behavior.useWhReceiptForPlan = false`.

### 2.3 Production line mapping

- File: `G:\Logistics\4_BSA\9_Scripts_Reports\Daily_Production_IT\PVS\ProdLine_Project_Map.csv`
- Columns:
  - `prod_line` – code from QAD (e.g. `H_FG`)
  - `project` – display name (e.g. `BJA`, `KIA - ASSY`)

Used by `load_map_csv()` in `pvs_server.py` to populate the `line` field.

### 2.4 SQL Server

From `config/settings.json` and `.env`:

- Server: `a265m001`
- Database: `QADEE2798`
- Credentials: in `.env` (variables `DB_SERVER`, `DB_DATABASE`, `DB_USERNAME`, `DB_PASSWORD`).

Used by `fetch_produced_by_day()` and by other SQL queries (e.g. `queries/Item_Master.sql`).

---

## 3. Static HTML Outputs

### 3.1 Netlify build output

- Folder: `G:\Logistics\4_BSA\9_Scripts_Reports\Daily_Production_IT\netlify_static`
- File: `index.html`
- Generated by: `scripts/generate_static_pvs.py`

Deployed to Netlify via:

```bash
netlify deploy --prod --dir=netlify_static --no-build
```

Linked Netlify site name: **`dailyproduction2798`**  
Public URL: `https://dailyproduction2798.netlify.app`

### 3.2 TV HTML (Anthias / IIS)

- Physical path on share:  
  `\\a265m050\Groups\Production\Baza\HTML\PVS.html`

- Generated **from the same script**:
  - `scripts/generate_static_pvs.py` writes both `netlify_static/index.html` and `PVS.html`.

- Served by IIS as:
  - `http://10.138.144.117:97/PVS.html`

- This URL is configured as an asset inside the Anthias TV scheduler.

---

## 4. Services and URLs

### 4.1 TV Scheduler (Anthias)

- URL: `http://10.138.159.239/`
- Manages assets displayed on production TVs.
- One asset points to: `http://10.138.144.117:97/PVS.html`.

### 4.2 Flask live dashboard (when VM/service is used)

- Host: `0.0.0.0`
- Port: `5051`
- URL format: `http://<VM_HOSTNAME>:5051`

Used mainly for the live `/pvs.html` dashboard.

### 4.3 Health and API endpoints

- API data: `/api/pvs`  (JSON, used by `pvs.html`)
- Health check: `/api/health`

---

## 5. Scripts & Automation

### 5.1 Static snapshot generation

- Script: `scripts/generate_static_pvs.py`
- Responsibilities:
  - Calls `compute_metrics()` from `pvs_server.py`.
  - Embeds result into `templates/pvs_static.html`.
  - Writes:
    - `netlify_static/index.html`
    - `\\a265m050\Groups\Production\Baza\HTML\PVS.html`

### 5.2 Planner one-click refresh (source folder)

- Script: `G:\Logistics\6_Reporting\1_PVS\Refresh_PVS_Dashboard.bat`
- Steps:
  1. Activates Python virtual environment if present.
  2. Invokes `scripts/generate_static_pvs.py` to regenerate HTML.
  3. Opens browser to `http://10.138.144.117:97/PVS.html` for verification.
  4. Prompts: "Send PVS report to email list? (Y/N)"
  5. If Y, runs `scripts/send_pvs_email.py` to send HTML report via email.

### 5.3 Email report distribution

- Script: `scripts/send_pvs_email.py`
- Subject: `PVS Report (YYYY-MM-DD)` (yesterday's date)
- Body: HTML table with the same styling as the dashboard
- Recipients: Configured in `config/settings.json` under `email.recipients`

### 5.4 Netlify deployment

- Manual:
  - `deploy_now.bat` in project root
  - Runs generator then:
    - `netlify deploy --prod --dir=netlify_static --no-build`

- Scheduled (optional):
  - `scripts/deploy_to_netlify.ps1` – called by scheduled task
  - `scripts/install_netlify_task.ps1` – installs task `PVS_Netlify_Deploy` (08:45 CET, Mon–Fri).

---

## 6. Display & Behavior Settings (from settings.json)

### 6.1 Display

- Resolution: `1920x1080`
- Zoom: `100`%
- `display.showLastNRows`: `20`

### 6.2 Typography

- Base font size: `15px`
- Header size: `1.25rem`
- Group header: `1.4rem`
- Data: `1.3rem`
- Line names: `1.1rem`

### 6.3 Behavior

- `behavior.adherenceClampPercent`: `300`  
  (Adherence% is clamped to ±300%.)
- `behavior.recalcExcelOnLoad`: `false`
- `behavior.showWeekendDataOnMonday`: `true`
- `behavior.useWhReceiptForPlan`: `true`

### 6.4 Schedule

- `schedule.refreshTime`: `08:45` (CET)
- `schedule.daysOfWeek`: Monday–Friday
- `schedule.autoRefreshIntervalMs`: `0`  
  (Live dashboard uses daily refresh logic; static snapshot is refreshed via scripts.)

### 6.5 Email

- `email.smtp_server`: `smtp.adient.com`
- `email.smtp_port`: `25`
- `email.from_address`: `pvs-dashboard@adient.com`
- `email.recipients`: Array of email addresses to receive the PVS report
  - Currently: large list of salaried colleagues (see `config/settings.json` for the full list)

To add more recipients, edit `config/settings.json` and add addresses to the `recipients` array.

---

This file is for IT, planners, and anyone maintaining the PVS dashboard so they can quickly see **where data comes from, where it goes, and which paths/IPs must be updated** if the environment changes.
